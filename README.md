# Пример кода при выполнении тестового задания

## Исходные данные
- Каталог [FpDbTest](FpDbTest), который содержит:
  - DatabaseInterface.php
  - Database.php (пустые методы)
  - DatabaseTest.php
  - test.php
  - [README.txt](FpDbTest/README.txt) (текст задания)

## Краткое описание задания - собственная интерпретация
> Создать преобразователь запросов для БД Mysql, заменяющий спецификаторы из набора на текстовые конструкции с использованием массива аргументов к запросу. Аргументы бывают массивами с особым использованием. Среди спецификаторов есть особый "Условный" вид, включающий часть запроса с другими спецификаторами.

## Создание минимальной инфраструктуры для разраотки (Docker-compose)
Этапы создания:
- Оборачиваем исходный каталог в каталог инфраструктуры Докера
- Создаем два контейнера с PHP 8.3 и Mysql 8
- Инициализация необходимых библиотек и минимальной структуры БД
- Инициализация конфига БД для исполнения кода теста
- Принято решение отказаться от хоста "localhost" в конфигурации БД, из-за трудности в Докере работы между контейнерами по localhost. Хост был заменён на имя контейнера с Mysql.

## Проектирование приложения
- Расширяемость и универсальность за счет полиморфизма спецификаторов
- Разделение зон отвественности на абстракции (Database, QueryBuilder, Replacer, SpecifierConfig, Specifier)
- Оптимизация читаемости действий
- Установление закрытости абстракций
- Аккумуляция единственной отвественности
- Инверсия зависимостей через конструкторы до уровня Database, где происходит настройка QueryBuilder

## Тестирование
Тестирование доступно через исходный код от заказчика (минимальное требование заказчика):
- Запуск Докер-окружения. Инициализация БД при первом запуске требует несколько минут!
```
docker-compose up -d --build
```
- Запуск теста:
```
docker-compose exec php php /app/FpDbTest/test.php
```
при успешном выполнении теста возвращается ответ:
```
OK
```

# Пояснения
- Это не отдельный компонент для композера
- Задание выполнено с соблюдением первоначальных условий и без их замены на "более правильные"
- Высший уровнень абстракции не может быть вынесен выше класса Database, т.к. это искажает первоначальные условия. Конструктор нельзя рефакторить для вынесения зависимостей выше - это будет самовольным изменением заданных условий задачи.
- Уровень абстракции Replacer может быть убран, т.к. потенциально не будет использоваться в реальных условиях. Но данное решение, как теоретическое, сделано с максимальным уровнем абстрагирования, которое допускает избыточность абстракций на определенном уровне. Т.е. предполагается, что QueryBuilder может использовать совершенно другие варианты замены, кроме спецификаторов.
- Зависимость от mysqli проходит по всем уровням абстракции только из-за того, что конечная реализация классов спецификаторов использует максимально безопасный метод escape, предоставляемый самой СУБД. При замене данного метода на собственный (достаточно безопасный), можно облегчить инициализацию начальных классов для потенциального DI-контейнера - добавить вариант класса по умолчанию во всех зависимостях.
- Названия классов отличаются от частопринятых в ORM с похожими функциями, чтобы выделить данное решение как теоретический пример абстрагирования, а скопировать "велосипед"
